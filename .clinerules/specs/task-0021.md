# [タスク番号: 0021]: 単体テスト (主要コンポーネント)

## 説明

主要なビジネスロジックを持つコンポーネント（例: `LogEntryFactory`, `LogFileHandler`, `LogWriteService`, `FileUploadService`, `IoTHubClient`）に対して単体テストを作成します。xUnit と Moq (または NSubstitute) を使用して、各コンポーネントが期待通りに動作することを確認します。

## タスク種別

- [ ] 環境構築
- [ ] 機能実装
- [ ] バグ修正
- [ ] リファクタリング
- [x] テスト
- [ ] ドキュメント
- [ ] 調査

## 優先度

中

## 見積もり工数

[ストーリーポイント: 3] (約1.5日)

## 依存関係

- 前提タスク: #0006, #0007, #0008, #0009, #0016, #0019 (各コンポーネントの実装完了)
- 関連タスク: なし

## 受け入れ基準

- [ ] テストプロジェクトがソリューションに追加されている。
- [ ] xUnit と Moq (または NSubstitute) のNuGetパッケージがテストプロジェクトに追加されている。
- [ ] `LogEntryFactory` のランダムメッセージ選択ロジック、タイムスタンプ生成がテストされている。
- [ ] `LogFileHandler` のファイルパス管理、日付変更処理、ログ追記処理（正常系、異常系）がテストされている。
- [ ] `LogWriteService` のログエントリ生成とファイル書き込み呼び出しがテストされている。
- [ ] `FileUploadService` の基本フロー、リトライロジックがテストされている（`IIoTHubClient` はモックを使用）。
- [ ] `IoTHubClient` の各メソッド呼び出しが、Azure SDKの挙動を模倣したモックまたは実際の（テスト用）IoT Hubに対してテストされている（可能な範囲で）。
- [ ] テストカバレッジが目標値（例: 70%以上）を達成している。

## 技術的な詳細

- テストプロジェクトは、メインプロジェクトとは別に作成します。
- 依存コンポーネントはインターフェースを通じてモック化し、テスト対象のユニットを分離します。
- ファイルI/Oを伴うテストでは、一時ファイルを使用するか、ファイルシステム操作を抽象化してモック化するなどの工夫が必要です。
